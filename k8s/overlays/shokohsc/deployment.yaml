---
kind: Deployment
apiVersion: apps/v1
metadata:
  name: ouistity
spec:
  template:
    spec:
      containers:
        - name: ouistity
          image: shokohsc/ouistity
          args:
            - dev-serve
          env:
            - name: ENV
              value: development
            - name: BASE_HOST
              value: localhost
            - name: BASE_PORT
              value: "80"
            - name: API_GATEWAY_HOST
              value: api.comics.shokohsc.home
            - name: API_GATEWAY_PORT
              value: "80"
            - name: GRAPHQL_GATEWAY_HOST
              value: apollo.comics.shokohsc.home
            - name: GRAPHQL_GATEWAY_PORT
              value: "80"
            - name: THUMBOR_HOST
              value: thumbor.comics.shokohsc.home
            - name: THUMBOR_PORT
              value: "80"
            - name: USE_THUMBOR
              value: "true"
          ports:
            - name: serve
              containerPort: 5000
              protocol: TCP
            # - name: dev
            #   containerPort: 3000
            #   protocol: TCP
            # - name: browser-sync
            #   containerPort: 3002
            #   protocol: TCP
      #     lifecycle:
      #       postStart:
      #         exec:
      #           command:
      #             - /bin/sh
      #             - -c
      #             - update-ca-certificates
      #     volumeMounts:
      #     - mountPath: /usr/local/share/ca-certificates
      #       name: tls
      # volumes:
      #   - name: tls
      #     csi:
      #       driver: csi.cert-manager.io
      #       volumeAttributes:
      #             csi.cert-manager.io/issuer-name: ca-cluster-issuer
      #             csi.cert-manager.io/issuer-kind: ClusterIssuer
      #             csi.cert-manager.io/is-ca: "true"
